<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Using PowerShell to overcome node_modules directory woes - Damian mullins" />

    <title>Use PowerShell to npm uninstall all packages - DamianMullins.com - Development Blog for Damian mullins</title>

    <!--[if lte IE 8]><link rel="stylesheet" href="/assets/dist/css/kickoff-old-ie.css"><![endif]-->
    <!--[if gt IE 8]><!--><link rel="stylesheet" href="/assets/css/style.css"><!--<![endif]-->
    
    <link href="http://feeds.feedburner.com/damianmullins" rel="alternate" type="application/rss+xml" title="Development Blog for Damian mullins" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@DJMelonz" />
    <meta name="twitter:creator" content="@DJMelonz" />
    <meta name="twitter:title" content="Use PowerShell to npm uninstall all packages" />
    <meta name="twitter:description" content="Using PowerShell to overcome node_modules directory woes" />
    <meta name="twitter:image" content="http://www.damianmullins.com/assets/img/logo-tcard.png" />

    <script>
        var docElem = window.document.documentElement;
        docElem.className = docElem.className.replace(/\bno-js\b/g, '') + 'js';
    </script>
</head>

<body>


<div class="skipToContent">
    <a href="#mainContent" class="btn btn--primary">Skip to main content</a>
</div>

<header class="header" role="banner">
    <div class="l-container">
        <div class="header-logo">
            <a href="/"><img src="/assets/img/plus_djmelonz.png" /></a>
        </div>
    </div>
</header>


<main id="mainContent" class="section">
    <div class="l-container post">
        <header>
            <h1>Use PowerShell to npm uninstall all packages</h1>
        </header>
        
        <p class="post-date">Posted <time datetime="2015-07-23T14:18:00">23rd July 2015</time>

            
        </p>
        
        <p>Recently I needed to delete all npm package folders which had been installed into the <code>node_modules</code> directory of a project. Attempting to manually delete the folders occasionally failed due to the <a href="https://msdn.microsoft.com/en-us/library/aa365247%28v=vs.85%29.aspx#maxpath">maximum path length limitation</a> Windows imposes. I didn&#39;t fancy running <code>npm uninstall</code> for each package individually as there were a lot of them, and knowing that I would likely need to repeat this task again I decided to try my hand at writing some PowerShell to uninstall each package listed in either the <code>devDependencies</code> section of <code>package.json</code>, or in the <code>node_modules</code> directory itself. </p>
<h2 id="uninstall-packages-attempt-one">Uninstall packages, attempt one</h2>
<p>First up I wrote a function which removes package folders added by a reference in <code>devDependencies</code>.</p>
<pre><code class="language-bash">Function Uninstall-NpmPackagesInDevDependencies {
    Param (
        <span class="comment"># Optional path to package.json</span>
        [String]<span class="variable">$pathToPackage</span>= $(Resolve-Path <span class="string">"package.json"</span>)
    )

    <span class="comment"># Read the json content</span>
    <span class="variable">$json</span> = (Get-Content <span class="variable">$pathToPackage</span> -Raw) | ConvertFrom-Json

    <span class="comment"># Loop over each package in devDependencies</span>
    ForEach (<span class="variable">$dep</span> <span class="keyword">in</span> (<span class="variable">$json</span>.devDependencies | Get-Member -MemberType *Property).Name) {
        <span class="comment"># Uninstall the package</span>
        iex <span class="string">"npm uninstall <span class="variable">$dep</span>"</span>
    }
}</code></pre>
<p>It works! However a few pesky folders still remained as they were saved in another section of the <code>package.json</code>.</p>
<h2 id="uninstall-packages-attempt-two">Uninstall packages, attempt two</h2>
<p>To deal with the leftover folders I created a second function which loops over all folders in the <code>node_modules</code> directory and uses the name of each folder to uninstall the package.</p>
<pre><code class="language-bash">Function Uninstall-NpmPackagesInNodeModules {
    Param (
        <span class="comment"># Optional path to node_modules directory</span>
        [String]<span class="variable">$pathToNodeModules</span> = (Get-Item <span class="string">".\node_modules"</span>).FullName
    )

    Get-ChildItem <span class="variable">$pathToNodeModules</span> | ForEach {
        <span class="comment"># Uninstall the package</span>
        iex <span class="string">"npm uninstall <span class="variable">$($_.Name)</span>"</span>
    }
}</code></pre>
<p>Trying out slightly different ForEach syntax for a bit of fun, I managed to remove all directories, regardless of whether the packages were saved in <code>package.json</code> or the path length was too long.</p>
<h2 id="one-liners">One liners</h2>
<p>After some further searching online I came across a nice <a href="http://blog.legacyteam.info/2014/10/how-to-remove-all-local-npm-packages/">bash command</a> for this sort of thing:</p>
<pre><code class="language-bash"><span class="keyword">for</span> package <span class="keyword">in</span> `ls node_modules`; <span class="keyword">do</span> npm uninstall <span class="variable">$package</span>; <span class="keyword">done</span>;</code></pre>
<p>Which led me to wonder what the equivilent would be if I shortened the <code>Uninstall-NpmPackagesInDirectory</code> function. </p>
<p>Stripping the function right back, and substituting method names for their shorter aliases resulted in</p>
<pre><code class="language-bash">ls (gi <span class="string">".\node_modules"</span>).FullName | % { iex <span class="string">"npm uninstall <span class="variable">$($_.Name)</span>"</span> }</code></pre>
<p>It doesn&#39;t read as well as the bash command, but I don&#39;t think it&#39;s too bad.</p>
<p>Just for the hell of it I thought I&#39;d have a go at shortening the <code>Uninstall-NpmPackagesInDevDependencies</code> function as well, the result:</p>
<pre><code class="language-bash">($(gc <span class="string">"package.json"</span> -raw) | convertfrom-json).devdependencies | gm -membertype *property | % { iex <span class="string">"npm uninstall <span class="variable">$dep</span>"</span> }</code></pre>
<p>Not likely to remember that one off the top of my head the next time I need to use it.. </p>

        
        <div id="disqus_thread" class="post-comments"></div>
    </div>
</main>


    <section class="related section">
        <div class="l-container">
            <header>
                <h1>Related Posts</h1>
            </header>
            
            <div class="articles u-noMargin">
                

    <article class="articles-item">
        <a href="/blog/my-first-week-with-python-django">
            <h2 class="articles-item-title">My first week with Python, Django &amp; Google App Engine</h2>
            <time class="articles-item-posted">16th August 2012</time>
        </a>
    </article>

    <article class="articles-item">
        <a href="/blog/importing-asp-net-5-tag-helpers">
            <h2 class="articles-item-title">Importing ASP.NET MVC 6 Tag Helpers</h2>
            <time class="articles-item-posted">20th August 2015</time>
        </a>
    </article>


            </div>
        </div>
    </section>


<section class="newsletter section">
    <div class="l-container">
        <header>
            <h1>Sign up to my newsletter!</h1>
        </header>
        
        
<p>Need Input is a newsletter comprised of anything and everything web related, from HTTP to SVG; CSS to JSX; W3C to PNG; … You get the point.</p>
<p>The title comes from the classic film Short Circuit 2, and main character Johnny Five’s insatiable need for more input, much the same as my need for the most interesting web news, tips, techniques, and tutorials.</p>
<p>Lovingly crafted by myself each week, I collate a list of links across various categories, gathered from the internets, books, podcasts, videos, conferences, and colleagues, then delivered into your inbox. </p>
<p>Suggestions and submissions are welcome, send them to me on <a href="https://twitter.com/DJMelonz">Twitter</a>, or email them to <a href="mailto:damian@lowflyingowls.co.uk">damian@lowflyingowls.co.uk</a>.</p>
<p>Subscribe below!</p>


<form class="newsletter-form" action="https://www.getrevue.co/profile/need-input/add_subscriber" method="post" name="revue-form" target="_blank">  
    <div class="form-controlGroup">
        <label class="form-label is-visuallyHidden" for="member_email">Email address</label>
        <div class="form-controlGroup-inputWrapper">
            <input class="form-input" id="member_email" placeholder="Your email address..." type="email" name="member[email]" required="required">
        </div>
    </div>
    <button class="btn btn--primary" type="submit" name="member[subscribe]">Subscribe</button>
</form>

    </div>
</section>


<footer class="footer section">
    <div class="l-container footer-content">
        <div class="footer-about">
            <p>Hi, I'm Damian Mullins, a Software engineer working at Just Eat. Cranking out code in C#, JavaScript, CSS &amp; others, always looking to learn more!</p>
        
            
        </div>
        <div class="footer-links">
            <ul class="unstyled">
    <li><a href="mailto:hello@damianmullins.com" rel="external" title="Contact me via email">Email</a></li>
    <li><a href="https://github.com/DJMelonz" rel="external" title="View my GitHub profile">GitHub</a></li>
    <li><a href="https://twitter.com/DJMelonz" rel="external" title="Talk to me on Twitter">Twitter</a></li>
    <li><a href="https://uk.linkedin.com/in/damianmullins" rel="external" title="View my LinkedIn profile">LinkedIn</a></li>
</ul>

            <p>&copy; 2016 Damian Mullins</p>
        </div>
    </div>
</footer>


<script>
    var disqus_shortname = 'damianmullins';
    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-1425869-12', 'auto');
    ga('send', 'pageview');
</script>

</body>

</html>

